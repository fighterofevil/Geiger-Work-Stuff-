<script>
    var li = jQuery('#DDmenu li');
    var liSelected;
    
    var inputTypes = ['input', 'select', 'button', 'textarea'];
    
    jQuery(window).keydown(function(e){        
        
        var focusedElement = document.activeElement;
        var inputTypes = ['input', 'select', 'button', 'textarea'];
        
        ## console.log(liSelected);
        ## console.log(focusedElement);

        ## original location for keydown/keyup        
        
        ## fires if Enter key is pressed and if focseded element on the page is not an input field defined in inputTypes

        if ( (e.which == 13) && (focusedElement && inputTypes.indexOf(focusedElement.tagName.toLowerCase()) == -1) ) { // enter
            
            ## console.log("enter key" );

            if (jQuery('#DDmenu').is(":focus")) {

                ## console.log("showing focused element");
                ## console.log(focusedElement);                
                ## console.log(jQuery(focusedElement).html());
              
                ## removes simulated hover state and focus for drop down navigation 

                jQuery('.productCategories').removeClass("adaNav");                                          
                jQuery('#DDmenu').removeAttr( 'style' );
                jQuery('#DDmenu').blur();                
            }
            else{
                
                ## console.log("showing focused element and not in DDmenu");
                ## console.log(focusedElement);                    
                ## console.log(jQuery(focusedElement).html());
                
                
                ## detects if focus is on anchor tag within the menu. if so, then will open that link. 

                if(focusedElement.tagName=="A"){
                    ## console.log("it is a link");
                    ## console.log(focusedElement.href);
                    
                    window.open(focusedElement.href,"_self");
                }

                ## adds simulated hover state and focus for drop down navigation 

                jQuery('.productCategories').addClass("adaNav");
                jQuery('#DDmenu').css("display","block"); 
                jQuery("#DDmenu").attr("tabindex",-1).focus();
            }
        }  
        
         ## fires if Esc key is pressed. 

         if (e.which == 27){
            ## console.log("esc key");            

            ## removes simulated hover state and focus for drop down navigation and menu elements. 
            
            jQuery('.productCategories').removeClass("adaNav");
            jQuery('.activeLi').removeClass('activeLi');
            jQuery('.adaNavLink').removeClass('adaNavLink');                               
            jQuery('#DDmenu').removeAttr( 'style' );
            jQuery('#DDmenu').blur();
            
            ## resets tracking of location of selected element in drop down navigation
            
            ## console.log(liSelected);

            liSelected = undefined;

            ## console.log("reset li");
            ## console.log(liSelected);            

            jQuery(liSelected).find("a").removeAttr("tabindex");
            liSelected.removeClass('activeLi');            
            next = liSelected.eq(0);            
         }
         
        ## checks to see if dropd own menu has been opened, if so, then allow tracking of keyup/keydown events. 
        ## note activeLi is a class used to help keep track of which LI element is currently selected. There is no CSS for this class. 

        if(jQuery(".productCategories").hasClass("adaNav")){
            
            ## console.log("menu is open");

            if(e.which === 40){
                
                ## console.log("in keydown function");

                ## prevents scrolling of page on keypress events 
                e.preventDefault();
                
                if(liSelected){
                
                    -->>> you are here kevin <<<----    

                    liSelected.removeClass('activeLi');
                    jQuery(liSelected).find("a").removeClass("adaNavLink");                                    
                    jQuery(liSelected).find("a").removeAttr("tabindex");
                    
                    next = liSelected.next();
                    if(next.length > 0){
                        liSelected = next.addClass('activeLi');                        
                        jQuery(liSelected).find("a").addClass("adaNavLink");
                    }else{
                        liSelected = li.eq(0).addClass('activeLi');    
                        jQuery(liSelected).find("a").addClass("adaNavLink");
                    }
                }else{
                    liSelected = li.eq(0).addClass('activeLi');                    
                    jQuery(liSelected).find("a").addClass("adaNavLink");
                }             
                
                ## gives focus to selected link 
                jQuery(liSelected).find("a").attr("tabindex",-1).focus();;              

            }else if(e.which === 38){

                ## console.log("in keyup function");
                ## prevents scrolling of page on keypress events 
                e.preventDefault();
                
                if(liSelected){
                    liSelected.removeClass('activeLi');
                    jQuery(liSelected).find("a").removeClass("adaNavLink");
                    
                    ## jQuery(liSelected).removeAttr("tabindex");
                    jQuery(liSelected).find("a").removeAttr("tabindex");
                    
                    next = liSelected.prev();
                    if(next.length > 0){
                        liSelected = next.addClass('activeLi');
                        jQuery(liSelected).find("a").addClass("adaNavLink");
                    }else{
                        liSelected = li.last().addClass('activeLi');
                        jQuery(liSelected).find("a").addClass("adaNavLink");
                    }
                }else{
                    liSelected = li.last().addClass('activeLi');
                    jQuery(liSelected).find("a").addClass("adaNavLink");
                }
                ## jQuery(liSelected).attr("tabindex",-1).focus();
                jQuery(liSelected).find("a").attr("tabindex",-1).focus();;
                
                console.log("after the tabindex assigned "+liSelected);
            }

        }
        else{
            console.log("menu is closed");
        }
         
    });    
    
    document.onclick = popMessage;
    
    function popMessage(){
        console.log("hey you clicked the mouse");
        
        
        var testfocusedElement = document.activeElement;
        ## var inputTypes = ['input', 'select', 'button', 'textarea'];

        console.log("test focused element")
        console.log(testfocusedElement);
    
        if (testfocusedElement && inputTypes.indexOf(testfocusedElement.tagName.toLowerCase()) !== -1) {
            console.log("This is an input");
        }
        else{
            console.log("This is not an input");
            
            ## jQuery('#DDmenu').css("display","none");
            
            jQuery('#DDmenu').removeAttr( 'style' );
            jQuery('#DDmenu').blur();
            jQuery('.productCategories').removeClass("adaNav");               
        }        
    }

</script>