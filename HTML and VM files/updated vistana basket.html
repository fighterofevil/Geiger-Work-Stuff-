<!DOCTYPE html>
#parse("/$vendorSettingsDTO.vendorId/$vendorSettingsDTO.themeId/siteConfig.vm")


#########################################################################

#set($focusNum = $productsDetails.products.size())
#if($crossSell.size())
    #set($itemsCount = $crossSell.size() + $focusNum)
#else
    #set($itemsCount = $focusNum)
#end
#if($focusNum > 0) 
  #set($focusNum = $focusNum - 1) 
#end

#########################################################################
##Sorry you have exceeded your purchase allowance remaining balance of $ 100000.00. Please remove items from your basket first.
#macro ( showErrorMessage $status )
        #if($status.errors.errorCount>0)
          <div class="warning">
            #foreach($error in $status.errorMessages)
              #if ($error.indexOf("exceeded your purchase allowance")>0 && $isPointStore=='TRUE')
                Sorry you have exceeded your purchase allowance remaining balance of $regExp.currencyInteger($viewStoreCurrency.locale,  $customerAllowances) #if ( $customerAllowances==0) Point #else Points #end
. Please remove items from your basket first.
              #else
                 $error
              #end
            #end
          </div>   
        #end
#end

#macro ( showPriceOnBasket $price)
#if($isPointStore && $isPointStore=='TRUE')
  $regExp.currencyInteger($viewStoreCurrency.locale,  $price)
#else
$$basketDTO.formatter.currency($price)
#end
#end

<html id="pageBasket">
  <head>
    <title>#if($!pagetitle) $pagetitle  #else #springMessage("basketTitle") - $!{htmlSiteName} #end</title>
    #parse('libMarkupHead.vm')
    #parse("/$vendorSettingsDTO.vendorId/$vendorSettingsDTO.themeId/siteMarkupHead.vm")

    <script src="store/$vendorSettingsDTO.vendorId/assets/themes/kinto_en/plugins/yui/js/yahoo-dom-event.js"></script>
    <script src="store/$vendorSettingsDTO.vendorId/assets/themes/kinto_en/plugins/yui/js/container-min.js"></script>
    ## <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="store/$vendorSettingsDTO.vendorId/assets/themes/kinto_en/js/jquery.ui-effects.js"></script>
    <script src="store/$vendorSettingsDTO.vendorId/assets/themes/kinto_en/js/jqtouch.min.js"></script>
    <script src="store/$vendorSettingsDTO.vendorId/assets/themes/kinto_en/js/avetti.slider.js"></script>
    <script src="store/$vendorSettingsDTO.vendorId/assets/themes/kinto_en/js/lineItemAdd/lineItemAdd.js"></script>
    <script src="store/$vendorSettingsDTO.vendorId/assets/themes/kinto_en/js/lineItemAdd/lineItemAdd_event.js"></script>
    <script src="assets/commercelib/basket/saveBasket.js"></script>
    <script src="assets/commercelib/ajax/ajax_object.js"></script>
    <script src="assets/commercelib/ajax/ajax_utils_jQuery.js"></script>
    <script src="assets/commercelib/deliveryoption/deliveryoption.js"></script>
    <script src="assets/commercelib/utils/formatCurrency.js"></script>
    <script src="assets/plugins/yahooUI/build/calendar/calendar-min.js"></script>
    <script src="assets/commercelib/basket/basket.js"></script>
<script language="javascript" type="text/javascript">
var recentlyViewedCategory= function(vid, cid){
  jQuery.ajax({
  url: 'getrecentlyviewedcategories.ajx?vid=' + vid + '&cid=' + cid,
  dataType: 'json',
  cache: false,
  data: {},
  success: function(response) {
    var result = response['__Result'],
    len = result.length,
    i = 0;
    if(len > 0){
      var thenewURL = '';
        for(i; i < 1; i+=1){
          thenewURL = result[i]['url'];
        }
      }
      else{
        thenewURL = 'store.html?vid=${vendorSettingsDTO.vendorId}';
      }
      
      window.location.href=thenewURL;
    }
   
  });
}
</script>
  </head>
  <body>
##   implemented "new" header BEGIN 
    #if($!$headerPosition == "OUTSIDE") #displayHeader($!$displayCustomHeaderContent) #end
    <div id="container">
        #if($!$headerPosition == "INSIDE") #displayHeader($!$displayCustomHeaderContent) #end        
##   implemented "new" header END  
    ## <div id="container">
    ## commented out old header code - kevin - 03.27.19 BEGIN 
        ## #if($!$displayCustomHeaderContent == "YES")
        ## 	#parse("/$vendorSettingsDTO.vendorId/$vendorSettingsDTO.themeId/siteLayoutHeaderNav.vm")
        ## #else
        ## 	#parse("libLayoutHeader1.vm")
        ## 	#parse("libLayoutMenu1.vm")
        ## #end
    ## commented out old header code - kevin - 03.27.19 END        
      <div id="content" role="main">
        <h1>#springMessage('vm.basket.title')</h1>  
        #if($customerAllowances)
          #set($cusalllowances=$math.roundTo(2,$!customerAllowances))
        #else
          #set($cusalllowances=0)
        #end

        #if($productsDetails.allowanceswarningmsg!='' && $productsDetails.enableOrderAllowance == 'ALLOWANCE')
          <div class="warning">$productsDetails.allowanceswarningmsg</div>
        #end
        #springBind( "basketDTO.*" )
        #showErrorMessage($status)

        #*
        #if($status.errors.errorCount>0)
          <div class="warning">
            #foreach($error in $status.errorMessages)
              $error
            #end
          </div>   
        #end
        *#
        <form name="VIEWCART" action="" method="post" onSubmit="javascript:updateQuantities();">
          <input id="js-vid" type="hidden" value="$vendorSettingsDTO.vendorId">    
          <input id="js-update-mode" type="hidden" value="refresh">    
          <input type="hidden" name="_targetupdateBasket" value="basket.html?vid=$vendorSettingsDTO.vendorId"/>
          <input type="hidden" name="mode" value=""/>
          <input type="hidden" name="itemscount" value="$itemsCount"/>
          #if($productsDetails.products.size()>0)
            #if(!$currencyInUse)
              #foreach($cur in $storeCurrencies)
                #if($cur.def==1)
                  <input type="hidden" name="c" value="$cur.id" />
                #end
              #end
            #else
              <input type="hidden" name="c" value="$currencyInUse" />
            #end

            #*================================
              Start Cart Table
            =================================*#
            <table class="p-table cart-table">
              <col class="col1" />
              <col class="col2" />
              <col class="col3" />
              <col class="col4" />
              <col class="col5" />
              <col class="col6" />
              <thead>
                <tr>
                  <th class="first" scope="col">&nbsp;</th>
                  <th scope="col">Image</th>
                  <th scope="col">#springMessage('vm.basket.item')</th>
                  <th scope="col">#springMessage('vm.basket.desc')</th>
                  ##<th scope="col">#springMessage('vm.basket.listprice')</th>
                  <th scope="col">#springMessage('vm.basket.pointstouse')</th>
                  <th scope="col">#springMessage('vm.basket.qty')</th>
                  <th class="last" scope="col">#springMessage('vm.basket.total')</th>
                </tr>
              </thead>
              #set($key = 0)
              #set($listpricetotal = $math.toDouble("0.00"))
              #set($subtotal = $math.toDouble("0.00"))
              #springBind( "basketDTO.basketItems.*" )
              #if($status.errors.errorCount>0)
                #set($bindStatus=true)
              #else
                #set($bindStatus=false)
              #end
              #set($totalQty = 0)
              #set($regsubtotal = 0)
              <tbody>   
                #foreach( $product in $productsDetails.products)
                  #set($myCount = $velocityCount - 1)
                  <input type="hidden" id="compCode_$myCount" value="$product.compCode">
                  <input type="hidden" name="basketItems[$myCount].itemId" value="$product.itemid"/>
                  <input type="hidden" name="basketItems[$myCount].vendorId" value="$product.vendor"/>
                  <input type="hidden" name="basketItems[$myCount].itemToProcess" value="true"/>
                  <input type="hidden" name="basketItems[$myCount].editMode" value="true"/>
                  <input type="hidden" name="basketItems[$myCount].basketItemId" value="$!product.basketItemId"/>
                  <input type="hidden" id="basketItems[$myCount].inventoryHistoryId" name="basketItems[$myCount].inventoryHistoryId" value="$!product.inventoryHistory.invhistid"/>
                  <input type="hidden" name="basketItems[$myCount].oldCompCode" value="$product.compCode"/>
                  <input type="hidden" name="basketItems[$myCount].removal" value="false"/>
                  <input type="hidden" value="P" name="orderType">
                  #set ($basketItemDTO=$basketMap.get($product.basketItemId))
                  #foreach($attribute in $product.attributesCollection)
                    #set($rowNumber = $velocityCount - 1)
                    <input type='hidden' name='basketItems[$myCount].attributes[$rowNumber].attributeId' value='$!attribute.attributeId' />
                    <input type='hidden' name='basketItems[$myCount].attributes[$rowNumber].optionId' value='$!attribute.option.optionId'/>
                    <input type='hidden' name='basketItems[$myCount].attributes[$rowNumber].value' value='$!attribute.value' />
                  #end
                  #set($customTextExists = 0)
                  #set($customTextOutput = "")
                  #foreach($custNote in $product.customizationNote)
                    #set($customTextExists = 1)
                    #set($rowNumber = $velocityCount - 1)
                    <input type='hidden' name='basketItems[$myCount].customizationNote[$rowNumber]' value='$!custNote' />
                    #set($customTextOutput = "$customTextOutput<br/>$!custNote")
                  #end
                  <input type='hidden' name='basketItems[$myCount].customized' value='true' />
                  <tr>
                    <td class="first">
                      <p>
                        #if (!$product.parentProduct)
                          <a href="javascript:removeFromBasket($key)" class="icon-trash">
                            &times;
                          </a>
                        #end
                      </p>
                    </td>
                    <td>
                      <div class="item-thumb" #if ($product.parentProduct) style="text-indent:2em;" #end>
                        #if (!$product.parentProduct)
                          <a href="$seourl.encodeURL("storeitem.html?iid=$product.itemid&vid=$vendorSettingsDTO.vendorId")?biid=$product.basketItemId">
                        #end
                        #if($product.cimage != "")       
                          <img src="store$product.cimage" alt='$product.title' style="width:50px;" />
                        #else
                          <img src="store/$vendorSettingsDTO.vendorId/assets/items/thumbnails/noimage.jpg" alt='$product.title' style="width:50px;"/>
                        #end
                        #if (!$product.parentProduct) </a> #end
                      </div>
                    </td>
                    <td>
                      #if ($product.parentProduct)
                        <div class="item-desc custom-item">
                          <p class="item-title">$product.title</p>
                          #set($parentProduct = $product.parentProduct)
                          #set ($isCustomizationItem = false)
                          #if ($product.code.indexOf("CUSTOM")>=0)
                            #set ($isCustomizationItem = true)
                          #end
                          <p class="code"> #springMessage('vm.basket.code'): $product.compCode
                            #if ($isCustomizationItem)  
                              <a href="$seourl.encodeURL("storeitem.html?iid=$parentProduct.itemid&vid=$vendorSettingsDTO.vendorId")?biid=$product.basketItemId">edit</a>
                            #end
                          </p>
                          #if ($isCustomizationItem)
                            <p>
                              #foreach($custNote in $parentProduct.customizationNote)
                                $!custNote <br/>
                              #end
                            </p>
                          #end
                        </div>
                      #else
                        <div class="item-desc">
                          <p class="item-title">
                            <a href="$seourl.encodeURL("storeitem.html?iid=$product.itemid&vid=$vendorSettingsDTO.vendorId")?biid=$product.basketItemId">$product.title</a>
                          </p>
                          <p class="code">
                            #springMessage('vm.basket.code'):&nbsp;$product.compCode
                          </p>
                        </div>
                        <div class="item-attributes">
                          #if($product.attributesCollection)
                            #foreach($productAttrib in $product.attributesCollection)
                              #set($attype = $productAttrib.attype)
                              #set($attrNum  = $velocityCount - 1)
                              #if($attype && ($attype == 2 ||$attype == 1 ))
                                <p class="attrib">
                                  $productAttrib.prompt : $productAttrib.option.ddText
                                </p>
                              #end
                              
                              #if($attype && $attype == 3)
                                <span>$productAttrib.dataName</span>
                                <b>$productAttrib.textValue</b> 
                              #end
                            #end
                            
                            #if($customTextExists == 1)
                                <p class="attrib customtext" style="width:225px">
                                    CUSTOM IMPRINT:
                                    $customTextOutput
                                </p>
                            #end
                          #end
                        </div>
                        #foreach($error in $product.errors)
<div class="error-text-area">
                          $error.message
</div>
                        #end
                      #end
                    </td>
                    <td>
                      #if($product.inventoryHistory.deliveryoption && $product.inventoryHistory.deliveryoption!=4)                 
                        <div class="item-desc">  
                          #if ($product.parentProduct)  
                            <p class="custom-item">
                              $product.description
                            </p>
                          #else
                            #if ($product.inventoryHistory)
                              <div class="qtyShipped" id="inlinecontainer${myCount}" >
                                #if( $product.deliveryOptions.size() > 1 )
                                  You've ordered more than what's in stock.
                                  <ul class="radios-list">
                                    #foreach( $key in $product.deliveryOptions.keySet() )
                                      <li>
                                        <label>
                                          <div class="input">
                                            <input type="radio" onClick="if(checkQty('qty_${myCount}'))checkMinOrderQTYInLineDeliveryOption($myCount,1,'$vendorSettingsDTO.vendorId', 'dooks',this.value,'basketItems[$myCount].inventoryHistoryId','$product.qty','','' );" name="basketItems[$myCount].newDeliveryOption" value="$key" #if($key == $product.inventoryHistory.deliveryoption) checked #end >
                                          </div>
                                          <div class="label">
                                            $product.deliveryOptions.get($key)
                                          </div>
                                        </label>
                                      </li>
                                    #end
                                  </ul>
                                #else
                                  #if($product.inventoryHistory.deliveryoption == 1)
                                    #if ($product.inventoryHistory.ship2date)
                                      <p>#springMessage('vm.basket.partialship') ${product.inventoryHistory.ship1qty} #springMessage('vm.basket.itemsafter') $date.format('MMMM dd, yyyy', $product.inventoryHistory.ship1date) #springMessage('vm.basket.andshiptheremaining') ${product.inventoryHistory.ship2qty} #springMessage('vm.basket.after') $date.format('MMMM dd, yyyy', $product.inventoryHistory.ship2date) #springMessage('vm.basket.whenavailable')</p>
                                    #else
                                      <p>#springMessage('vm.basket.partialship') ${product.inventoryHistory.ship1qty} #springMessage('vm.basket.itemsafter') $date.format('MMMM dd, yyyy', $product.inventoryHistory.ship1date) #springMessage('vm.basket.andshiptheremaining') ${product.inventoryHistory.ship2qty} #springMessage('vm.basket.whenavailable')</p>
                                    #end
                                  #end
                                  #if($product.inventoryHistory.deliveryoption == 2)
                                    #if ($product.inventoryHistory.ship1date)
                                      <p>#springMessage('vm.basket.shipcomplete') ${product.inventoryHistory.ship1qty} #springMessage('vm.basket.itemsafter') $date.format('MMMM dd, yyyy', $product.inventoryHistory.ship1date) #springMessage('vm.basket.whenavailable')</p>
                                    #else
                                      <p>#springMessage('vm.basket.shipcomplete') ${product.inventoryHistory.ship1qty} #springMessage('vm.basket.items') #springMessage('vm.basket.whenavailable')</p>
                                    #end
                                  #end

                                  #if($product.inventoryHistory.deliveryoption == 3)
                                    <p>#springMessage('vm.basket.dropship') ${product.inventoryHistory.ship1qty} #springMessage('vm.basket.itemsfrommanufacturerin') ${product.inventoryHistory.daystodeliver} #springMessage('vm.basket.days')</p>
                                  #end
                                #end ## %end for if $product.deliveryOptions.size() > 1%
                              </div>  <!-- end qtyShipped -->
                            #end

                            ## TODO: Fix conditional/element ordering below (not lining up)

                            #if ($product.inventory.enableEditDeliveryDate)
                              #if(!$product.comment || $product.comment=="")
                                <div class="deliveryDate">
                                  <div id="showEditDate$myCount">
                                    #if($product.inventoryHistory.ship1date)
                                      <a onclick="showCalendar(this, 'basketItems[$myCount].comment','$date.format('MMMM dd, yyyy', $product.inventoryHistory.ship1date)')" >#springMessage('vm.basket.editdate')</a>
                                    #else
                                      <a style="cursor:pointer" onclick="showCalendar(this, 'basketItems[$myCount].comment','')" >#springMessage('vm.basket.editdate')</a>
                                    #end
                                  </div>
                                  <div id="showReqDate$myCount">
                                    #else
                                      <div id="showReqDate$myCount">
                                        <p>
                                          #springMessage('vm.basket.requestdate'):
                                          <a style="cursor:pointer" onclick="showCalendar(this, 'basketItems[$myCount].comment','')" >
                                            $!product.comment
                                          </a>
                                        </p>
                                      #end
                                    <input type="hidden" size="15" value="$!product.comment" name="basketItems[$myCount].comment" id="basketItems[$myCount].comment">
                                  </div>
                                #end
                              #end
                            </div>
                          #end

                          #if ($product.promotions.size() > 0)
                            #set($fullProductDiscount = $math.toDouble("0.00"))
                            #foreach($promotionUsageInfo in $product.promotions)
                              #if($promotionUsageInfo.discount > 0)
                                #set($fullProductDiscount = $math.add($fullProductDiscount, $promotionUsageInfo.discount))
                              #else
                                #foreach($getCondition in $promotionUsageInfo.promotion.get)
                                  #if($getCondition.getbuyid==8)
                                    #foreach($freeProduct in $productsDetails.products)
                                      #if($freeProduct.code==$getCondition.name)
                                        #set($fullProductDiscount = $math.add($fullProductDiscount, $freeProduct.discountPrice))
                                        <!-- $freeProduct.code, $freeProduct.discountPrice -->
                                      #end
                                    #end
                                  #end
                                #end
                              #end
                            #end
                            <br>
                            <p class="unl">#springMessage('vm.basket.additionalsavings'):$basketDTO.formatter.currency($fullProductDiscount)</p>
                            <ul>
                              #foreach ($promotionUsageInfo in $product.promotions)
                                #if($promotionUsageInfo.discount > 0)
                                  <li><strong>$promotionUsageInfo.promotion.name:</strong> $basketDTO.formatter.currency($promotionUsageInfo.discount) </li>
                                #else
                                  #set($freeProductDiscount = $math.toDouble("0.00"))
                                  #foreach($getCondition in $promotionUsageInfo.promotion.get)
                                    #if($getCondition.getbuyid==8)
                                      #foreach($freeProduct in $productsDetails.products)
                                        #if($freeProduct.code==$getCondition.name)
                                          #set($freeProductDiscount = $freeProduct.discountPrice)
                                        #end
                                      #end
                                    #end
                                  #end
                                  #if($freeProductDiscount !=0)
                                    <li><strong>$promotionUsageInfo.promotion.name.trim():</strong>  $$basketDTO.formatter.currency($freeProductDiscount)</li>
                                  #end
                                #end
                              #end
                            </ul>
                          #end
                        </div>  
                        <!-- End item-desc -->
                        <div id="description${myCount}"></div> <!-- End div description${myCount} -->
                      </td>             
                      ##<td class="ar">
                      ## #if($math.toInteger($math.sub($product.listprice, $product.price)) > $math.toInteger(0))
                      ##    <p class="list-price"><em>$$basketDTO.formatter.currency($product.listprice)</em></p>
                      ##  #end
                      ##</td>            
                      <td class="ar">
                        ## #if($math.toInteger($product.price)==$math.toInteger(0))
                        ## ## --- If Price is less than $1.00, show "Free".
                        ##   <p class="price">#springMessage('vm.basket.free')</p>
                        ## #else
                        ## ## --- Show normal price
                          <p class="price">#showPriceOnBasket($product.price)</p>
                        ## #end  
                      </td>
                      <td class="ac">
                        <!--QTY-->
                        #if ($product.parentProduct)
                          <input class="qty-input" type='text' NAME='basketItems[$myCount].quantity' ID='qty_${key}' VALUE='$product.qty' maxlength="5"  onKeyDown="if (event.keyCode==13){document.VIEWCART.mode.value='updateBasket';document.VIEWCART.submit();event.keyCode=9;}" DISABLED/>   
                        #else
                          <input class="qty-input" type='text' NAME='basketItems[$myCount].quantity' ID='qty_${key}' VALUE='$product.qty' maxlength="5"  onKeyDown="if (event.keyCode==13){document.VIEWCART.mode.value='updateBasket';document.VIEWCART.submit();event.keyCode=9;}" />
                        #end
                        #if ($product.parentProduct)
                          &nbsp;
                        #else
                          <p>
                            <a style="cursor:pointer" onclick="if(checkQty('qty_${key}'))checkMinOrderQTYWithoutPopup($myCount,1,'$vendorSettingsDTO.vendorId', 'checks','','basketItems[$myCount].inventoryHistoryId','$product.qty','redirect','document.VIEWCART.mode.value=\'updateBasket\';document.VIEWCART.submit();' ); return false;" >#springMessage('vm.basket.update')</a>
                          </p>
                        #end
                      </td>
                      <td class="ar last">
                        <p class="total">
                          #showPriceOnBasket($product.totalPrice)
                        </p>
                      </td>
                    </tr>
                    #set($subtotal = $math.add($subtotal , $product.totalPrice))                
                    #set($regtotal = $math.mul($product.listprice, $product.qty))
                    #set($regsubtotal = $math.add($regsubtotal, $regtotal))
                    #set($totalQty = $math.add($totalQty, $product.qty))
                    #set($key = $key+1)
                  #end
                </tbody>
              <tfoot class="totals">
                <tr class="subtotal hide">
                  <td colspan="4" class="empty-cel">&nbsp;</td>
                    #set($savings = $math.roundTo(2, $math.sub($regsubtotal, $subtotal)))
                    #if($math.toInteger($savings) > $math.toInteger(0))
                      <td class="ar vat lbl first">#springMessage('vm.basket.yoursave'):</td>
                      <td class="ar vat val">$$basketDTO.formatter.currency($savings)</td>
                    #else
                      <td class="empty-cel first" colspan="2">&nbsp;</td>
                    #end
                      <td class="ar vat lbl">
                        #springMessage('vm.register.subtotal') ($totalQty #if($totalQty > 1)#springMessage('vm.register.items')#else #springMessage('vm.register.item')#end):
                      </td>
                      <td class="ar vat val last">#showPriceOnBasket($subtotal)</td>
                    </tr>
                    <input type="hidden" value="$subtotal" id="subtotal" name="subtotal">
                    #if($productsDetails.totalDiscount > 0)
                      <tr class="discount">
                        <td colspan="6" class="empty-cel">&nbsp;</td>
                        <td class="ar vat lbl first">#springMessage('vm.basket.additionalsavings'):</td>
                        <td class="ar vat val last">
                          $$basketDTO.formatter.currency($productsDetails.totalDiscount)
                          #set($subtotal = $math.roundTo(2,$math.sub($subtotal,$productsDetails.totalDiscount)))
                          <input type="hidden" value="$productsDetails.totalDiscount" id="totalDiscount" name="totalDiscount">
                      </td>
                    </tr>
                  #end
                  <tr class="tax hide">
                    <td colspan="6" class="empty-cel">&nbsp;</td>
                    <td class="ar vat lbl first">
                    #if($preLocationDTO.usebillingaddress=='true')
                      <span id="taxlab1">#springMessage('vm.basket.tax'):</span>
                      <span id="taxlab2" class="hide">#springMessage('vm.basket.tax'):</span>
                    #else
                      <span id="taxlab1">#springMessage('vm.basket.estimate.tax'):</span>
                      <span id="taxlab2" class="hide">#springMessage('vm.basket.estimated.tax'):</span>
                    #end
                  </td>
                  <td class="ar vat val last" id="estimatedtax"></td>
                </tr>
                <tr class="total">
                  <td colspan="5" class="empty-cel">&nbsp;</td>
                  <td class="ar vat lbl first">#springMessage('estimatedTotal'):</td>
                  <td class="ar vat val last" id="totalcost">                        
                    #set($total=$math.sub($subtotal, 0))
                    #showPriceOnBasket($total)
                  </td>
                </tr>
              </tfoot>
            </table>
            #*================================
              End Cart Table
            =================================*#

            <div class="promos">
              #if ($!displayCouponCode == "YES")
                <div class="coupon f-form horizontal">
                  <div class="f-row">
                    <label><strong>#springMessage('vm.basket.promotionorcouponcode'):</strong></label>
                    <div class="f-field">
                      <input type="text" name="promotionCode" value=""/>
                      <span class="f-buttons">
                        <input type="button" value="#springMessage("button.APPLY")" onClick="javascript:document.VIEWCART.mode.value='updateBasket';removeItems($key);document.VIEWCART.submit();" class="promo-button btn" />
                      </span>
                    </div>
                  </div>
                </div>
                #end
                #if ($!displayOfferCode == "YES")
                <div class="f-row">
                  <label><strong>#springMessage('vm.basket.offerocode'):</strong></label>
                  <div class="f-field">
                    <input type="text" name="offercode_${vendorSettingsDTO.vendorId}" value=""/>
                    <span class="f-buttons">
                      <input type="button" value="#springMessage("button.APPLY")" onClick="javascript:document.VIEWCART.mode.value='updateBasket';removeItems($key);document.VIEWCART.submit();" class="promo-button btn" />
                    </span>
                  </div>
                </div>
                #end
              </div>

#if ($!displaySaveCart == "YES")
            #if(!${welcomeMatDTO.loggedIn})
              <div class="f-buttons restoreBasket padding-b10">
                <strong>#springMessage('vm.basket.logintorestoreasavedbasket'):</strong> 
                <input type="button" onclick="JavaScript:window.location.href='https://${appSettingsDTO.getDomainAlias($vendorSettingsDTO.vendorId)}/${appSettingsDTO.AppName}/signin.html?vid=${vendorSettingsDTO.vendorId}&mt=1&redirecturl=${welcomeMatDTO.currentEncodePage}'" class="proceed btnLogin btn" value="#springMessage("button.LOGIN")">
              </div>
            #else
              #if ($availBasketList)
                <!-- Start save basket -->
                <div id="basketdata" class="f-form">
                #if($basketDTO.basketdatamessage1!='')
                  <div class="text">
                    $basketDTO.basketdatamessage1
                  </div>
                #end
                #if($basketDTO.basketdatamessage2!='')
                  <div class="text">
                    $basketDTO.basketdatamessage2
                  </div>
                #end                        
                <input type="hidden" id="bd_nickname" name="bd_nickname" >
                <input type="hidden" name="_targetupdateBasketData" value="basket.html?vid=$vendorSettingsDTO.vendorId"/>
                <div id="warning"></div>
                <div class="f-row">
                  <input id="save" type="radio"  name="bd_mode" value="s" onclick="onSave()"/>
                  <div class="f-field">
                    <label for="save">#springMessage('vm.basket.savebasket')</label>
                  </div>
                <div id="nicknameInputBox" class="basketList hide">
                  <div class="f-field">
                    <label for="basketinputbox">#springMessage('vm.basket.promp1'):</label> 
                  </div>
                  <input id="basketinputbox" type="text" onblur="updateNickname(this.value)"/>
                </div>
              </div>
              #if($availBasketList.size()>0)
                <div class="f-row">
                  <div class="f-field">
                    <input id="delete" type="radio" name="bd_mode" value="d" onclick="onDelete()"/>
                  </div>  
                  <label for="delete">#springMessage('vm.basket.delbasket')</label>
                  <div id="nicknameSelectList1" class="basketList hide">
                    <label for="basketlist1">#springMessage('vm.basket.promp2'):</label> 
                    <select id="basketlist1" onchange="updateNickname(this.value)">
                      <option value="">#springMessage('vm.contact_us.select')</option>
                      #foreach($nickname in $availBasketList)
                        <option value="$nickname">$nickname</option>
                      #end
                    </select>
                  </div> 
                </div>
                <div class="f-row">
                  <div class="f-field">
                    <input id="restore" type="radio"  name="bd_mode" value="r" onclick="onRestore()"/> 
                  </div>  
                  <label for="restore">#springMessage('vm.basket.restoresavedbasket')</label>
                  <div id="nicknameSelectList2" class="basketList hide">
                    <label for="basketlist2">#springMessage('vm.basket.promp2'):</label>  
                    <select id="basketlist2" onchange="updateNickname(this.value)">
                      <option value="">#springMessage('vm.contact_us.select')</option>
                      #foreach($nickname in $availBasketList)
                        <option value="$nickname">$nickname</option>
                      #end
                    </select>
                  </div>
                </div>
              #end

              <div class="f-buttons">   
                <input type="button" name="updateBasket" class="btn" value="#springMessage("button.UPDATE")" onclick="submitUpdateBasket()"/>
              </div>
            </div>
            <!-- End save basket -->
#end
          #end 
        #end 


        <input type="hidden" name="_targetcheckout" value="checkout.html?vid=$vendorSettingsDTO.vendorId"/>
        <div class="f-buttons">
          <input id="checkoutbtn" class="btn btn-primary" type="button" value="#springMessage('vm.basket.tocheckout')" onclick="javascript:document.VIEWCART.mode.value='checkout';document.VIEWCART.submit();" style="float:right;" />
##          <input type="button" id="continueShopBtn" class="btn" value="#springMessage('vm.basket.toshop')" onclick="javascript:document.location='store.html?vid=${vendorSettingsDTO.vendorId}'"/>
<input type="button" id="continueShopBtn" class="btn" value="#springMessage('vm.basket.toshop')" onclick="recentlyViewedCategory('$vendorSettingsDTO.vendorId','33029'); "/>
        </div>

        #if($crossSell.size()>0)
          <div id="item_content_right">
            <span><b>#springMessage('vm.basket.alsolike')</b></span>
            #set($idx = 1)
            #foreach($item in $crossSell)
              #set($vendorID = $vendorSettingsDTO.vendorId)
              #set($curItemId = $item.get("item").itemid) 
              #set($curItemTitle = $item.get("item").title)          
              <div class="item_content_right_con">
                <div class="item_content_right_con_img">
                  #if($item.get("item").cimage != "")
                    <img src="store${item.get("item").cimage}" width="75" height="61"/>
                  #else
                    <img src="store/$vendorSettingsDTO.vendorId/assets/images/spacer.gif" width="75" height="61" />
                  #end
                </div>
              </div>
              <div class="item_content_right_con">
                <span>
                  <a href="$seourl.encodeURL("storeitem.html?iid=$curItemId&vid=$vendorID")" class="infoslink">${curItemTitle}</a>
                </span>  
                <span> $$regExp.showPrice($item.get("price").listprice)</span>
                <br>
                <a href="action.html?mode=addItems&iid${idx}=${curItemId}&qty${idx}=1&url=basket.html%3Fvid%3D$vendorSettingsDTO.vendorId">
                  #springMessage('vm.basket.addtocart')
                </a>
              </div>
            #end
          </div><!-- //#item_content_right -->   
        #end

        ##TODO:  #else after #end? Test and fix

        #else
          <div class="basket-item-desc f-buttons">
            <b>#springMessage('vm.basket.msg')</b>
            <input type="button" id="continueShopBtn" class="btn" value="#springMessage('vm.basket.toshop')" onclick="recentlyViewedCategory('$vendorSettingsDTO.vendorId','33029'); "/>
#if ($!displaySaveCart == "YES")
<br/>
            #if(!${welcomeMatDTO.loggedIn})
              <strong>
                <a href="https://${appSettingsDTO.getDomainAlias($vendorSettingsDTO.vendorId)}/${appSettingsDTO.AppName}/signin.html?vid=${vendorSettingsDTO.vendorId}&mt=1&redirecturl=${welcomeMatDTO.currentEncodePage}">
                  #springMessage('vm.header.login')
                </a> #springMessage('vm.basket.loginmsg')  
              </strong>
            #else
              <!-- Start restore basket -->
              #if($availBasketList.size()>0)
                <div id="basketdata" class="f-form">   
                  <input type="hidden" id="bd_nickname" name="bd_nickname" >
                  <input type="hidden" name="_targetupdateBasketData" value="basket.html?vid=$vendorSettingsDTO.vendorId"/>
                  <div class="f-row">
                    <div class="f-field">
                      <input id="restore" type="radio" checked="checked"  name="bd_mode" value="r" onclick="onRestore()"/> 
                    </div>
                    <label for="basketlist2">#springMessage('vm.basket.restoresavedbasket'):</label>  
                    <div id="nicknameSelectList2" class="basketList">
                      <select id="basketlist2" onchange="updateNickname(this.value)">
                        <option value="">#springMessage('vm.contact_us.select')</option>
                        #foreach($nickname in $availBasketList)
                          <option value="$nickname">$nickname</option>
                        #end
                      </select>
                    </div>
                    <div id="warning"></div>
                  </div>
                  <div class="f-row">
                    <input class="btnclass btn" type="button" name="updateBasket" value="#springMessage("button.UPDATE")" onclick="submitUpdateBasket()">
                  </div>
                </div>
              #end
            #end
#end
          </div> <!--//.basket-item-desc -->
        #end

        </form>
        
        <!-- Modal Containers -->
        ## TODO:
        ## Preferred method is to have the js module append to body (if it doesn't exist) during initialization.
        ## With this method, the module breaks when the elements are missing. Not very portable.
        <div id= "test" class="yui-skin-sam">
          <div id="cal1Container"></div> 
        </div>
        <div id="deliverypopup" class="popup" style="visibility: hidden;"></div>

      </div> <!--//#content -->

## original code for footer.  commented out to implant new footer code. - kevin 03.27.19 - BEGIN
## #if($!$displayCustomFooterContent == "YES")
##   #parse("/$vendorSettingsDTO.vendorId/$vendorSettingsDTO.themeId/siteLayoutFooter.vm")
## #else
##       #parse("libLayoutFooter1.vm")
## #end
## original code for footer.  commented out to implant new footer code. - kevin 03.27.19 - END


## "new footer" code BEGIN 
      #if(${displayStickyFooter} == "TRUE") #displayStickyFooterPush() #end
      #if($!$footerPosition == "INSIDE") #displayFooter($!$displayCustomFooterContent) #end
    </div> <!--//#container -->
    #if($!$footerPosition == "OUTSIDE") #displayFooter($!$displayCustomFooterContent) #end
## "new footer" code END


    </div> <!--//#container -->
    #if(${welcomeMatDTO.loggedIn})
      <script>   
        var Dom = YAHOO.util.Dom;
        var itemsCount = ${itemsCount};
        var maxBasket = 5; 
        function BasketData(){
          this.basketData = new Array($availBasketList.size());
          #foreach($nickname in $availBasketList)
            #set ($rowNumber = $velocityCount - 1)
            this.basketData[$rowNumber]="$nickname";
          #end
        }  
        
        var basketData = new BasketData();
        
        BasketData.prototype.validateNickName = function(nickname){
          #* checked option *#
          var basket_modes=document.getElementsByName("bd_mode");
          var selectbasket=false;
          for(var i=0;basket_modes!=undefined&&i<basket_modes.length;i++){
            if(basket_modes[i].checked){
              selectbasket=true;
            }
          }
          if(!selectbasket){
            Dom.addClass('warning','warning');
            document.getElementById("warning").innerHTML = "#springMessage("vm.basket.checkoption")";
            return false;
          }
          if(document.getElementById("save")!=null){
            if(document.getElementById("save").checked){
              if (!validateString(nickname)){
                Dom.addClass('warning','warning');
                document.getElementById("warning").innerHTML = "#springMessage("vm.basket.validnickname")";
                return false;
              }
            }
          }
          
          if(document.getElementById("delete") && document.getElementById("delete").checked){
            var value=document.getElementById("basketlist1").value;
            if(value==""){
              Dom.addClass('warning','warning');
              document.getElementById("warning").innerHTML = "#springMessage("vm.basket.choosebasket")";
              return false;
            }
          }
          if(document.getElementById("restore") && document.getElementById("restore").checked){
            var value=document.getElementById("basketlist2").value;
            if(value==""){
              Dom.addClass('warning','warning');
              document.getElementById("warning").innerHTML = "#springMessage("vm.basket.choosebasket")";
              return false;
            }
          }
           
          if (this.basketData.length<maxBasket){
            return true;
            
            for(var i=0; i<this.basketData.length; i++){
              if (this.basketData[i] == nickname)
                return true;
            }
            
            alert("The number of saved baskets could not exceed " + maxBasket);
            Dom.addClass('warning','warning');
            document.getElementById("warning").innerHTML = "#springMessage("vm.basket.maxnumberbaskets")";
            return false;
          }
        }
      </script>
    #end

    <script>
      $(document).ready(function(){
        createCalendar();
        //loadRegion();
      });
    </script>

    #parse("/$vendorSettingsDTO.vendorId/$vendorSettingsDTO.themeId/siteMarkupFoot.vm")
    #parse("libMarkupFoot.vm")
  </body>
</html>